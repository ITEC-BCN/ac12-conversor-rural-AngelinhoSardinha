<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable type="KIND_SpriteKind" id=",,.$Hx*WC5+_XBSLYGau">coordenadas</variable><variable type="KIND_SpriteKind" id="=H9l/j?;#)BS8D-ltub8">shop_door</variable><variable type="KIND_SpriteKind" id="^t|56u{181[)o.[o[_vG">outside_gim_door</variable><variable type="KIND_SpriteKind" id="7CM]1PA#|NVD=N(cN0;R">central_park_door</variable><variable type="KIND_SpriteKind" id="eyIybNl=ki-[xWBP[F3@">inside_gim_door</variable><variable type="KIND_SpriteKind" id="Dn`ky/!3{G?u0|r?TdBd">npc</variable><variable type="KIND_SpriteKind" id="9j`ghF7+yKOCO.ocN~CH">player</variable><variable type="KIND_SpriteKind" id="O];cFSxb^9bHPnR%iGqg">enemy</variable><variable type="KIND_SpriteKind" id="bvO3*Q!+5agndN[?C`zk">Projectile</variable><variable type="KIND_SpriteKind" id="-uLqFKYS=t4)q5O;@T9u">Food</variable><variable type="KIND_SpriteKind" id="B}x!ia(!FMesfK=h9d{S">MiniMenu</variable><variable id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</variable><variable id="-A(,}hw]S0-zH^U-P!h;">indice</variable><variable id="NV9z+Oh6*.9b5B.+uX;4">villager</variable><variable id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</variable><variable id=".6ZlkT6e-^8frma:7%|I">esta_en_npc</variable><variable id="(!,hX%3g(2N,=?rnX.SX">nombre_articulo</variable><variable id="ba_J7m(,?6IX:,]_k:8z">nombres_visibles</variable><variable id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</variable><variable id="r4|7GbebQV21}V*+D`vq">precio_leña</variable><variable id="0sL=HgQ|3!(yL_h9F_%0">precios</variable><variable id="ZRczQc(Jao*v7DE!j(HN">gallinas</variable><variable id="6[ft;.+Mp/a)dl2v%2[}">patatas_kg</variable><variable id="}ge6-sZ(a:`:D5AdpeB;">cabras</variable><variable id="NgpZq8kEndnk^@mB4.o}">huevos</variable><variable id="D?G`r8:r#2_ptXBkR^t1">caballos</variable><variable id="HsyTT}HCj^M3Q!3z(zy~">proximidad</variable><variable id="xipzET^NR{T;IT|Ki[wF">hit</variable><variable id="uHb;ll/(]5-HafauTz_~">vida_arbol</variable><variable id="N}Z0ie)pc+3g/(tD;ffG">enemigo</variable><variable id="K$!4;+[/}go6(]WT4-dg">shop_door2</variable><variable id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</variable><variable id="_=xPBVPX3xl5xi^;#:NT">npc_shop</variable><variable id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</variable><variable id="H^j)nqzSBp!gYMvYuy/2">inside_gim_door2</variable><variable id="+rUdWndk7G%W3QP_je;r">game_speed</variable></variables><comment id="-g:4u8e_Ll+0fKzR4Q;/" x="1948.921875" y="2132" w="280" h="120">
Proximidad con enemigo/árbol
</comment><comment id="5q.m8R$mNEZN}=jtb{eI" x="2273.921875" y="2132" w="430" h="120">
Variables de Estado de Proximidad y Botón A
</comment><comment id="^aVr6t}8_V(4G?K-J{xs" x="2748.921875" y="2132" w="480" h="120">
Bandera para saber si el jugador está sobre el NPC
</comment><comment id="H=x75s:n,w!yp~@~_j-F" x="3273.921875" y="2132" w="480" h="120">
Bandera para controlar si el botón A está reasignado al menú
</comment><comment id="pTK?3j#=3E9Rt@Y*0vJB" x="20" y="3431" w="230" h="120">
Variables de Inventario
</comment><comment id="ejqfr$e_Hz={]?x#g$bf" x="3798.921875" y="2132" w="250" h="120">
Variables de Trueque/Menú
</comment><comment id="6vkAGf#Q:PzAMi{-WJv@" x="4093.921875" y="2132" w="480" h="120">
Variables de Sprite (Declaración para evitar errores de referencia)
</comment><block type="pxt-on-start" id="pVbo]dxR{S**8;n6b[QE" x="20" y="20"><statement name="HANDLER"><block type="typescript_statement" id="?WyF_mgk-^)rK.gXFwiq"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let estado_menu = false" numlines="1" declaredvars="estado_menu"></mutation><next><block type="variables_set" id="]R$ZwQ%lo56I(WoR}hlM"><field name="VAR" id="+rUdWndk7G%W3QP_je;r">game_speed</field><comment pinned="false" h="80" w="160">Aseguramos que 'enemy' esté definido
---
=======================================================
II. VARIABLES DE ESTADO/INVENTARIO
=======================================================
Variables de Juego</comment><value name="VALUE"><shadow type="math_number" id="Vb$)?{!3EJWauNDrs7Io"><field name="NUM">100</field></shadow></value><next><block type="variables_set" id="b?=~O|Xsmq]Atr4iCu(}"><field name="VAR" id="uHb;ll/(]5-HafauTz_~">vida_arbol</field><value name="VALUE"><shadow type="math_number" id="a58IwTZR#23nZ+mw65=%"><field name="NUM">5</field></shadow></value><next><block type="variables_set" id="]w-jWZOfS{BT]5t+sk_f"><field name="VAR" id="6[ft;.+Mp/a)dl2v%2[}">patatas_kg</field><value name="VALUE"><shadow type="math_number" id="{rqo5D.8zin,@=co}U)."><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="2i[z8KDq;?`K2rkNqw!:"><field name="VAR" id="ba_J7m(,?6IX:,]_k:8z">nombres_visibles</field><comment pinned="false" h="80" w="160">Indica si el menú está abierto</comment><value name="VALUE"><shadow type="math_number" id="-*XNR$jy7QJKEoMacYKv"><field name="NUM">0</field></shadow><block type="lists_create_with" id="yN]Fk)xf46#a~[Z~[80:" inline="false"><mutation items="5" horizontalafter="3"></mutation><value name="ADD0"><shadow type="text" id="5jpLD0?.X5aEj]TUh/~4"><field name="TEXT">Gallina (6 kg Leña)</field></shadow></value><value name="ADD1"><shadow type="text" id="1={ZN0+#~BZP{(||U(J["><field name="TEXT">1.5 kg Patata (2 kg Leña)</field></shadow></value><value name="ADD2"><shadow type="text" id="T83,irP@A2D[f7}=Qv-`"><field name="TEXT">Cabra (5 kg Leña)</field></shadow></value><value name="ADD3"><shadow type="text" id="Rm(FnT?%*=Vk/6koB4LF"><field name="TEXT">12 Huevos (3 kg Leña)</field></shadow></value><value name="ADD4"><shadow type="text" id="t?y#cuVrPNd$-i`xddV4"><field name="TEXT">Caballo (12 kg Leña)</field></shadow></value></block></value><next><block type="variables_set" id="Do/gRbt8[OU[LN}%+=Bg"><field name="VAR" id="0sL=HgQ|3!(yL_h9F_%0">precios</field><value name="VALUE"><shadow type="math_number" id="7IZLgf]RF8uA`0JWqD2g"><field name="NUM">0</field></shadow><block type="lists_create_with" id="A3M=1[H6fd^J9+bL?10m" inline="false"><mutation items="5" horizontalafter="3"></mutation><value name="ADD0"><shadow type="math_number" id="24vpys[QQ`t:V3;)e-A@"><field name="NUM">6</field></shadow></value><value name="ADD1"><shadow type="math_number" id="9)dr^Oi%TMTW~i[s_O9-"><field name="NUM">2</field></shadow></value><value name="ADD2"><shadow type="math_number" id="ild5H|_AUc_n6;E;x=J}"><field name="NUM">5</field></shadow></value><value name="ADD3"><shadow type="math_number" id="6x:Pqf{dD.IU{?h`%Ia,"><field name="NUM">3</field></shadow></value><value name="ADD4"><shadow type="math_number" id="H{T/T=G95Nu=YupgPxO%"><field name="NUM">12</field></shadow></value></block></value><next><block type="typescript_statement" id="ZW7X%)]rEKF%JDJGCobq"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="controller.A.onEvent(ControllerButtonEvent.Pressed, on_a_normal_action)" numlines="1"></mutation><next><block type="hudsetScore" id="}ZTyEN.V])FZtZ5pK@,9"><comment pinned="false" h="80" w="160">---
=======================================================
VII. INICIALIZACIÓN DEL JUEGO
=======================================================</comment><value name="value"><shadow type="math_number" id="!;K6%WxiKQ9:Im~*YH|V"><field name="NUM">0</field></shadow></value><next><block type="gamesetbackgroundimage" id="4Qc_o{GxR)bIA_NoT-vY"><value name="img"><shadow type="background_image_picker" id="Fmv2~6w%6dKA$.vfVe=v"><field name="img">assets.image`paisaje`</field><data>{"commentRefs":[],"fieldData":{"img":"myImages.image7"}}</data></shadow></value><next><block type="variables_set" id="XY{Ao#R@G5OgdYB]Hlgd"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field><comment pinned="false" h="80" w="160">Creación de Sprites Iniciales</comment><value name="VALUE"><shadow type="math_number" id="@pE{-xz$B{`T2dZejfVa"><field name="NUM">0</field></shadow><block type="spritescreate" id="^P`8bDqkzb$q-0I:2LO,"><value name="img"><shadow type="screen_image_picker" id="H})La8wGZMe29iohi|RS"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . f f f f f f . . . . . 
. . . f f e e e e f 2 f . . . . 
. . f f e e e e f 2 2 2 f . . . 
. . f e e e f f e e e e f . . . 
. . f f f f e e 2 2 2 2 e f . . 
. . f e 2 2 2 f f f f e 2 f . . 
. f f f f f f f e e e f f f . . 
. f f e 4 4 e b f 4 4 e e f . . 
. f e e 4 d 4 1 f d d e f . . . 
. . f e e e e e d d d f . . . . 
. . . . f 4 d d e 4 e f . . . . 
. . . . f e d d e 2 2 f . . . . 
. . . f f f e e f 5 5 f f . . . 
. . . f f f f f f f f f f . . . 
. . . . f f . . . f f f . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="lHZC|.!Puy_Ctlx%}`Et"><field name="MEMBER">player</field></shadow></value></block></value><next><block type="variables_set" id="8bjv.^Vw}%(_-f4D}eR%"><field name="VAR" id="K$!4;+[/}go6(]WT4-dg">shop_door2</field><value name="VALUE"><shadow type="math_number" id="YQS8@:ZapAX@?1Xz|,|."><field name="NUM">0</field></shadow><block type="spritescreate" id="l3(WhGvr0Z2EaG(zJf2{"><value name="img"><shadow type="screen_image_picker" id="FKE@1DnyE,1%mx+9VlYY"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . 1 . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="l!`;V7|AoQs8v?[qSaQ7"><field name="MEMBER">shop_door</field></shadow></value></block></value><next><block type="variables_set" id="/wY@_xd0Z}J=$Y@|-OUy"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field><value name="VALUE"><shadow type="math_number" id="z,`;X;wgET~^y2j7+65F"><field name="NUM">0</field></shadow><block type="spritescreate" id="/uS:^IGYuX980O7GUTmD"><value name="img"><shadow type="screen_image_picker" id="3jz#o2pj~(lS1Og*5wYU"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . 3 . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="=^-HnG6m4,q5Ed7?;dq!"><field name="MEMBER">outside_gim_door</field></shadow></value></block></value><next><block type="spritesetpos" id="(binWwnx7@akWi;F0T?^"><value name="sprite"><block type="variables_get" id="Qkpk1qg~_?z0^.!SQe!k"><field name="VAR" id="K$!4;+[/}go6(]WT4-dg">shop_door2</field></block></value><value name="x"><shadow type="positionPicker" id="3RKH!66MSta4p;M@Q},/"><field name="index">136</field></shadow></value><value name="y"><shadow type="positionPicker" id="$[=~cG3bZ:*[=F6bBK-e"><field name="index">105</field></shadow></value><next><block type="spritesetpos" id="t4kqk7}=H0IR2PJEq.0X"><value name="sprite"><block type="variables_get" id="6S3+r~GMkdV{_W]zEx(:"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field></block></value><value name="x"><shadow type="positionPicker" id="b!udS8C]X9JL~,sa^Ou%"><field name="index">12</field></shadow></value><value name="y"><shadow type="positionPicker" id="2{x[/lB5I)D+V4SPx$1Y"><field name="index">101</field></shadow></value><next><block type="spritesetpos" id="s4MVV~|6*:.7^{q)KciF"><value name="sprite"><block type="variables_get" id="8_c/$Wpbu,g^m!L15_Qu"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="x"><shadow type="positionPicker" id="zL1)#_|NDD_q@lU1A}d-"><field name="index">76</field></shadow></value><value name="y"><shadow type="positionPicker" id="Q4aE,oT[dO]S1cog~$Z,"><field name="index">101</field></shadow></value><next><block type="game_control_sprite" id="rfbS]4,Iv$y@{/{hihNa"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="2" _input_init="true"></mutation><value name="sprite"><block type="variables_get" id=",L$pg6GUl%%wjfAmBWQ:"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="vx"><shadow type="spriteSpeedPicker" id="`QP|pi(K!LtR0eWJ+b`%"><field name="speed">100</field></shadow></value><value name="vy"><shadow type="spriteSpeedPicker" id="sz/%c~}L`vjpWvAiJJW{"><field name="speed">100</field></shadow></value><next><block type="spritesetsetbounceonwall" id="=%S{qQ#ZP-.[1nS6,[$W"><value name="sprite"><block type="variables_get" id="gUG0:@2{-fq~#Zh1KB`s"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="on"><shadow type="toggleOnOff" id=",1Fv2,cLqHP,8~Jg^YMm"><field name="on">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="gameinterval" id="S*WNQPK#f}3w,xl7n(ig" x="769" y="20"><comment pinned="false" h="80" w="160">---
=======================================================
VI. BUCLE DE VERIFICACIÓN (ON_UPDATE)
=======================================================
Definición de la función de verificación
Llamada explícita al método para establecer el intervalo de 500ms</comment><value name="period"><shadow type="timePicker" id="R,aFs,]`tfo0#e5lPz#1"><field name="ms">500</field></shadow></value><statement name="HANDLER"><block type="controls_if" id="@lCQWS7?,Q1#kiX!Jp:0"><comment pinned="false" h="80" w="160">1. Si la bandera esta_en_npc no se ha seteado a True por el overlap...</comment><value name="IF0"><shadow type="logic_boolean" id="bC^RIVO^-,Gp}]jT]:9)"><field name="BOOL">TRUE</field></shadow><block type="logic_negate" id=":CTJmN9{-3V:Cp[vaosW"><value name="BOOL"><shadow type="logic_boolean" id=")4g}sSqUK=svp,GYLv;|"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="B~D+6MOE`Ip7C7Lq#(#="><field name="VAR" id=".6ZlkT6e-^8frma:7%|I">esta_en_npc</field></block></value></block></value><statement name="DO0"><block type="controls_if" id="KfzKw),]-a6hH4r?{qFr"><comment pinned="false" h="80" w="160">2. Si el menú está abierto, lo cerramos.</comment><value name="IF0"><shadow type="logic_boolean" id="d5%fRa4o_-VfB~/%apGj"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="ad2oO~FkO+!(n?60l79["><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field></block></value><statement name="DO0"><block type="function_call" id="Q]6b@ag3aOyIp+98a.X$"><mutation name="cerrar_menu" functionid="JF2l7=SQvmJkAMK9M_xE"></mutation></block></statement><next><block type="controls_if" id="D%SdI:8MDdEilyXJuLlY"><comment pinned="false" h="80" w="160">3. Si el botón A estaba reasignado, lo restauramos a la acción normal.</comment><value name="IF0"><shadow type="logic_boolean" id="qOV%(frMHr(Pi-C1Z1dg"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="ym+Ug?cU6Al4#+y?59h*"><field name="VAR" id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</field></block></value><statement name="DO0"><block type="typescript_statement" id="ZCt/H,4DwzL]BjycKs{%"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="controller.A.onEvent(ControllerButtonEvent.Pressed, on_a_normal_action)" numlines="1"></mutation><next><block type="variables_set" id="OtO{ox3qxx0Ycx,f83HO"><field name="VAR" id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</field><value name="VALUE"><shadow type="math_number" id="[~KT[1eFK%b%rG,Z_u}e"><field name="NUM">0</field></shadow><block type="logic_boolean" id="@%yo5-[%LpJm61vB==z2"><field name="BOOL">FALSE</field></block></value></block></next></block></statement></block></next></block></statement><next><block type="variables_set" id="oos_6M)kPGS#o%Yq|Jl%"><field name="VAR" id=".6ZlkT6e-^8frma:7%|I">esta_en_npc</field><comment pinned="false" h="80" w="160">4. Resetear la bandera: La próxima vez que el overlap se ejecute, la pondrá a True.</comment><value name="VALUE"><shadow type="math_number" id="Dj)c$bxf7DBCPSkML%l?"><field name="NUM">0</field></shadow><block type="logic_boolean" id="viQ@#/%J76mrV^@8t}j1"><field name="BOOL">FALSE</field></block></value></block></next></block></statement></block><block type="keyonevent" id="d98)Z=B]-p86^0`j*v.`" x="1503" y="20"><field name="button">controller.up</field><field name="event">ControllerButtonEvent.Pressed</field><comment pinned="false" h="80" w="160">Funciones de Movimiento y Animación (Arriba/Abajo manejan el índice del menú)</comment><statement name="HANDLER"><block type="controls_if" id="RN=;{Y_$|`c[oFKo@HVu"><mutation else="1"></mutation><value name="IF0"><shadow type="logic_boolean" id="i6*V6;zDz_p.j/u;u;rQ"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="U1P.PY2]+O$gM|O1WPw)"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field></block></value><statement name="DO0"><block type="variables_set" id="70|X05QU|`,Cx:+E[3.m"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field><value name="VALUE"><shadow type="math_number" id="{^LR2}oCT|_3RygFQsnY"><field name="NUM">0</field></shadow><block type="math_modulo" id="e!T:ZMKVJNEM2#*Cq(_M"><value name="DIVIDEND"><shadow type="math_number" id=",oUK?yokC:F8(aN.ND6:"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="s@q1mjIVozAY;Zqrzb^C"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="96LnB`IwsgapT!D:foMb"><field name="NUM">0</field></shadow><block type="variables_get" id="pMod+glQeSK74~c8lYjW"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field></block></value><value name="B"><shadow type="math_number" id="t:j^)b+9X3T9ak[wYZyT"><field name="NUM">1</field></shadow></value></block></value><value name="DIVISOR"><shadow type="math_number" id="^H#^0v!K}SKTfsu=o)+_"><field name="NUM">0</field></shadow><block type="lists_length" id="Z@%2E%M|eGm8|$S3k:Iz"><value name="VALUE"><block type="variables_get" id="O3@So/R~2I0v9:N~LQY4"><field name="VAR" id="ba_J7m(,?6IX:,]_k:8z">nombres_visibles</field></block></value></block></value></block></value><next><block type="game_show_long_text" id="N$kf!cGhn7Ldpy68ue?-"><field name="layout">DialogLayout.Bottom</field><value name="str"><shadow type="text" id="-/cOTt/X^FcKClKRuB^t"><field name="TEXT">Intercambio: {nombres_visibles[indice]}</field></shadow></value></block></next></block></statement><statement name="ELSE"><block type="run_image_animation" id="vwlZr5cjWd9nVid/!oi;"><value name="sprite"><block type="variables_get" id="wjs`|e-_|*]Hc.Q6lz@U"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="frames"><shadow type="animation_editor" id="z#+S.@wPWIq|ey0h^^uP"><field name="frames">assets.animation`myAnim4`</field><data>{"commentRefs":[],"fieldData":{"frames":"myAnimations.anim6"}}</data></shadow></value><value name="frameInterval"><shadow type="timePicker" id="7^Ce0}SvJhcDX!7yTMpX"><field name="ms">200</field></shadow></value><value name="loop"><shadow type="toggleOnOff" id="M_Z8Yy6;65n6B57ngN;e"><field name="on">false</field></shadow></value></block></statement></block></statement></block><block type="keyonevent" id="uG_bK,VqR[3n|5tcNn(X" x="2459" y="20"><field name="button">controller.down</field><field name="event">ControllerButtonEvent.Pressed</field><statement name="HANDLER"><block type="controls_if" id="A0$-5|Eq3?c0Qn/^G3#U"><mutation else="1"></mutation><value name="IF0"><shadow type="logic_boolean" id="GBm+^3+e6RDC_/.6w5A:"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="-!]@yXKAos6Qk+Y{kQ)Y"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field></block></value><statement name="DO0"><block type="variables_set" id="ht|ZQDfw7hJ1[bktTR%Z"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field><value name="VALUE"><shadow type="math_number" id="zwkPT]$J_r4vYys[7+67"><field name="NUM">0</field></shadow><block type="math_modulo" id="E0DMX}DM9j?qNI@gHH=X"><value name="DIVIDEND"><shadow type="math_number" id="7xdgl%xl^JJ#xkDgB4hU"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="qieDc@tmjOS]Ed/~A2f~"><field name="OP">ADD</field><value name="A"><shadow type="math_number" id="b$E2G098F:0yehc9_pjq"><field name="NUM">0</field></shadow><block type="variables_get" id="J9;Y|pLsRK?*Dv/93|rv"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field></block></value><value name="B"><shadow type="math_number" id="}K~yW^r_-X.ni;/+h_=I"><field name="NUM">1</field></shadow></value></block></value><value name="DIVISOR"><shadow type="math_number" id="*RTpc,}mvNB%OjxuSIT/"><field name="NUM">0</field></shadow><block type="lists_length" id="H5Bv`J[M5+DdbLOo3I5G"><value name="VALUE"><block type="variables_get" id=",_67+iLP()C}76H#}Ol?"><field name="VAR" id="ba_J7m(,?6IX:,]_k:8z">nombres_visibles</field></block></value></block></value></block></value><next><block type="game_show_long_text" id="#dFLuCI!F:q1[:JGnSh~"><field name="layout">DialogLayout.Bottom</field><value name="str"><shadow type="text" id="800w22|ON+HL;$}SwspJ"><field name="TEXT">Intercambio: {nombres_visibles[indice]}</field></shadow></value></block></next></block></statement><statement name="ELSE"><block type="run_image_animation" id="skP:[(%jBVaG+Dofsj{g"><value name="sprite"><block type="variables_get" id="}q}wrx~Zl:-f;d!Yd[ia"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="frames"><shadow type="animation_editor" id="`G}B[yZzu9|C5t,x.(W@"><field name="frames">assets.animation`myAnim1`</field><data>{"commentRefs":[],"fieldData":{"frames":"myAnimations.anim3"}}</data></shadow></value><value name="frameInterval"><shadow type="timePicker" id="4Qk6+5(S@${%YrC;X}[t"><field name="ms">200</field></shadow></value><value name="loop"><shadow type="toggleOnOff" id="I~m[5Fgv0?%H[|w{f[|)"><field name="on">false</field></shadow></value></block></statement></block></statement></block><block type="keyonevent" id="bo%Cm8-r6}gJf7NO5na}" x="3415" y="20"><field name="button">controller.left</field><field name="event">ControllerButtonEvent.Pressed</field><statement name="HANDLER"><block type="run_image_animation" id="Vf/zzu?23_{T#t*{UfI["><value name="sprite"><block type="variables_get" id="5UP%}D=t$|zd2Vey4BAh"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="frames"><shadow type="animation_editor" id="{LkPY*o,3M-:X?!^zbL,"><field name="frames">assets.animation`myAnim0`</field><data>{"commentRefs":[],"fieldData":{"frames":"myAnimations.anim2"}}</data></shadow></value><value name="frameInterval"><shadow type="timePicker" id="x/Wgjqk.U.h!%Ch9jdC6"><field name="ms">200</field></shadow></value><value name="loop"><shadow type="toggleOnOff" id="iKw/=vEZ}e{SLKn@44Jo"><field name="on">false</field></shadow></value></block></statement></block><block type="keyonevent" id="z_^lNa~^L4gP%`2q[hnb" x="3739" y="20"><field name="button">controller.right</field><field name="event">ControllerButtonEvent.Pressed</field><statement name="HANDLER"><block type="run_image_animation" id="pkX5%3KJr4:.{{LlA;5K"><value name="sprite"><block type="variables_get" id="+8C)(r~%,K6$^FdxMbu5"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="frames"><shadow type="animation_editor" id="R}%Bna_}C1?d@7CodafR"><field name="frames">assets.animation`monkey_right`</field><data>{"commentRefs":[],"fieldData":{"frames":"myAnimations.anim9"}}</data></shadow></value><value name="frameInterval"><shadow type="timePicker" id="q{SN5KLW^2FN^G![ztsP"><field name="ms">200</field></shadow></value><value name="loop"><shadow type="toggleOnOff" id="eq*_?ex2?zDDF--T-c2T"><field name="on">false</field></shadow></value></block></statement></block><block type="spritesoverlap" id="AE(-MTsBv$08AMDdfkoX" x="4072" y="20"><comment pinned="false" h="80" w="160">---
=======================================================
V. MANEJO DE COLISIONES (OVERLAP)
=======================================================
**COLISIÓN NPC:** Se ejecuta MIENTRAS el jugador está sobre el NPC.</comment><value name="HANDLER_DRAG_PARAM_sprite"><block type="argument_reporter_custom" id="WbI]1ovHU80A;}#+F|o,"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">sprite</field></block></value><value name="kind"><shadow type="spritekind" id="!OQZ=e(Cp3T?7wXg92a^"><field name="MEMBER">player</field></shadow></value><value name="HANDLER_DRAG_PARAM_otherSprite"><block type="argument_reporter_custom" id="]M7)F5L6r878qDTQ(_@B"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">otherSprite</field></block></value><value name="otherKind"><shadow type="spritekind" id="QfFLYj_JeRC?q9`Y%s$Z"><field name="MEMBER">npc</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="3`(HquZcG=K!qYu93(z~"><field name="VAR" id=".6ZlkT6e-^8frma:7%|I">esta_en_npc</field><value name="VALUE"><shadow type="math_number" id="N2JvxPvh+OeDO|bAL5b!"><field name="NUM">0</field></shadow><block type="logic_boolean" id="hbMMjI((?,kt@Fj^HlkL"><field name="BOOL">TRUE</field></block></value><next><block type="spritesetpos" id="W=+n%iAMpU8O@^a%Y:_v"><value name="sprite"><block type="variables_get" id="T*|RLAeyL-}bOKWqX-u#"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="x"><shadow type="positionPicker" id="K`z$fIi[{wKaHB,AU7g5"><field name="index">97</field></shadow></value><value name="y"><shadow type="positionPicker" id="yb6N^eLJa*ojE=!@3oQ("><field name="index">36</field></shadow></value><next><block type="game_show_long_text" id="a/e!aN*9PD-!U2NGAA:O"><field name="layout">DialogLayout.Bottom</field><comment pinned="false" h="80" w="160">Mantenemos la posición forzada</comment><value name="str"><shadow type="text" id="Q=#0A7=jozPRvZn$e6*a"><field name="TEXT">¿Quieres intercambiar cosas? Presiona A.</field></shadow></value><next><block type="controls_if" id="d%HrHaW4+BKi4-tGK90/"><comment pinned="false" h="80" w="160">Reasigna el botón A para abrir/comprar si aún no está asignado</comment><value name="IF0"><shadow type="logic_boolean" id="C~5G+)UJ2xohfa;uT?0H"><field name="BOOL">TRUE</field></shadow><block type="logic_negate" id="46l=A|xmBOia]w^~Dg]T"><value name="BOOL"><shadow type="logic_boolean" id="rJ-X9M(n7rilMT+(d4=U"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="sKC3Sl]M)sVdVNM}mgK)"><field name="VAR" id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</field></block></value></block></value><statement name="DO0"><block type="typescript_statement" id="0rzuU}^OXk*;hfeH7@nc"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="controller.A.onEvent(ControllerButtonEvent.Pressed, function abrir_menu_wrapper() {" line1="            if (estado_menu) {" line2="                //  Si el menú ya está abierto, A es para comprar" line3="                procesar_trueque()" line4="            } else {" line5="                //  Si no está abierto, lo abrimos" line6="                abrir_menu()" line7="            }" line8="            " line9="        })" numlines="10"></mutation><next><block type="variables_set" id="^KTDxu#*9hJ*);lp_,J$"><field name="VAR" id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</field><value name="VALUE"><shadow type="math_number" id=",c[M+*Xrl5yE;C%-h5j`"><field name="NUM">0</field></shadow><block type="logic_boolean" id="irO,T~!!VQe[=0Tlez8X"><field name="BOOL">TRUE</field></block></value></block></next></block></statement></block></next></block></next></block></next></block></statement></block><block type="spritesoverlap" id="MCQp[**YK:n/@pB!0CeM" x="20" y="1513"><comment pinned="false" h="80" w="160">Colisión con enemigo (Mantenida)</comment><value name="HANDLER_DRAG_PARAM_sprite"><block type="argument_reporter_custom" id="OpM3}|`,nwr~Y;-utjwi"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">sprite6</field></block></value><value name="kind"><shadow type="spritekind" id="c?ocE+e.G9r^^9Z}a{]m"><field name="MEMBER">player</field></shadow></value><value name="HANDLER_DRAG_PARAM_otherSprite"><block type="argument_reporter_custom" id="fBsqg9OcGN%]#B:A416R"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">otherSprite6</field></block></value><value name="otherKind"><shadow type="spritekind" id="ZbRAkDvrcs^Vz,jxj4(Q"><field name="MEMBER">enemy</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="dEclN?ruHV;7JW%{lNxe"><field name="VAR" id="HsyTT}HCj^M3Q!3z(zy~">proximidad</field><value name="VALUE"><shadow type="math_number" id=",k)V6hq_Cxs~AfSVZZ|{"><field name="NUM">0</field></shadow><block type="logic_boolean" id="YeqdE,0.PGpg7_Jn7~e)"><field name="BOOL">TRUE</field></block></value><next><block type="controls_if" id="xu!P$mu{$`DOb:7QKm59"><value name="IF0"><shadow type="logic_boolean" id="Pa:i)0Ub/4]{=Q$uI*_R"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="-N+V)]S`+Vb#g!H/HVgU"><field name="OP">EQ</field><value name="A"><shadow type="math_number" id="Nh41m{9,8t8UY12K7a)e"><field name="NUM">0</field></shadow><block type="variables_get" id="$XP)!,L[yhqZ2I20mc6Z"><field name="VAR" id="xipzET^NR{T;IT|Ki[wF">hit</field></block></value><value name="B"><shadow type="math_number" id="Po9_onj0/BkFI:C(|i4E"><field name="NUM">0</field></shadow><block type="variables_get" id="gwvz-jjLjECa7Ps-NKtL"><field name="VAR" id="uHb;ll/(]5-HafauTz_~">vida_arbol</field></block></value></block></value><statement name="DO0"><block type="spritedestroy2" id="h]fL=JlJguK0BSKa1ppp"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="I9Fg#[!#O~SBoeJlgxOk"><field name="VAR" id="N}Z0ie)pc+3g/(tD;ffG">enemigo</field></block></value><next><block type="hudChangeScoreBy" id="2W?V,k`+y*@Pl}Tu6fHK"><value name="value"><shadow type="math_number" id="xg67WiqtOM3}G7YPSNe}"><field name="NUM">3</field></shadow></value><next><block type="variables_set" id="3Hsc+=gkqD0abrW,zxq$"><field name="VAR" id="HsyTT}HCj^M3Q!3z(zy~">proximidad</field><value name="VALUE"><shadow type="math_number" id="h(IbwQvjII7qmfY1I25G"><field name="NUM">0</field></shadow><block type="logic_boolean" id="p+eY,#J,.2Yz8M?6sjbm"><field name="BOOL">FALSE</field></block></value><next><block type="variables_set" id="zIrCCozTw-:(Kvt0%^5^"><field name="VAR" id="xipzET^NR{T;IT|Ki[wF">hit</field><value name="VALUE"><shadow type="math_number" id="=a)N=olc3Kq#W=Jrmz*["><field name="NUM">0</field></shadow></value></block></next></block></next></block></next></block></statement></block></next></block></statement></block><block type="spritesoverlap" id="f_Ni)Xgr;]n0W_RV6WFy" x="773" y="1513"><comment pinned="false" h="80" w="160">... El resto de tus funciones de colisión de puertas se mantienen ...
Colisión de Puertas (Mantenidas sin cambios)</comment><value name="HANDLER_DRAG_PARAM_sprite"><block type="argument_reporter_custom" id="/u-`ZM7awZBPq3)L]w:G"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">sprite4</field></block></value><value name="kind"><shadow type="spritekind" id="`YwllE|3k4GSLQ?U*3az"><field name="MEMBER">player</field></shadow></value><value name="HANDLER_DRAG_PARAM_otherSprite"><block type="argument_reporter_custom" id="CFnyNy)uHCFMCeLYY2)i"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">otherSprite4</field></block></value><value name="otherKind"><shadow type="spritekind" id="[*WG,arV3MJgU[TS_H,0"><field name="MEMBER">central_park_door</field></shadow></value><statement name="HANDLER"><block type="gamesetbackgroundimage" id="OLY|%6r:dDZah~l-WPYt"><value name="img"><shadow type="background_image_picker" id="$H;[MJ1Dlp0vNvZP,s:U"><field name="img">assets.image`paisaje`</field><data>{"commentRefs":[],"fieldData":{"img":"myImages.image7"}}</data></shadow></value><next><block type="variables_set" id="~:oxSxY^v`j1=e1|a,f}"><field name="VAR" id="K$!4;+[/}go6(]WT4-dg">shop_door2</field><value name="VALUE"><shadow type="math_number" id="PtH`yANO+4W-84.pgemT"><field name="NUM">0</field></shadow><block type="spritescreate" id="zjmXU12:MU-z?vS7bZ]H"><value name="img"><shadow type="screen_image_picker" id="]_c+QaoD4xU$D5d9-(=:"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . 1 . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="j?($IJS4_({_/-051Qsc"><field name="MEMBER">shop_door</field></shadow></value></block></value><next><block type="variables_set" id="HUNO[8AmjRBJrtpG6)U_"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field><value name="VALUE"><shadow type="math_number" id="M=ehJ4RKKqYdx-Ts*KNW"><field name="NUM">0</field></shadow><block type="spritescreate" id="/q;$}C0-:obNx,9Q$_2:"><value name="img"><shadow type="screen_image_picker" id=".S-f:T-$K{sF5_%k1C|t"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . 3 . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="^GermLXoi`|{}Ph7:C3="><field name="MEMBER">outside_gim_door</field></shadow></value></block></value><next><block type="spritesetpos" id="%4a1{Phq:b6fe@!#JJwm"><value name="sprite"><block type="variables_get" id="]{uzZBN~*fJC)d25_n(Z"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="x"><shadow type="positionPicker" id="*]L?e_;t?3E`t=F[W}7C"><field name="index">76</field></shadow></value><value name="y"><shadow type="positionPicker" id="%Z~QN*h`/Fj2kunvYo4p"><field name="index">101</field></shadow></value><next><block type="spritesetpos" id="Ux%2B+)(kfKeV/$VItw|"><value name="sprite"><block type="variables_get" id="bh%I,GW(P*UdUVlf+%Qb"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field></block></value><value name="x"><shadow type="positionPicker" id=".qPKSc*B;WcRECuB!:PM"><field name="index">12</field></shadow></value><value name="y"><shadow type="positionPicker" id="6rTk;%Bk%sNp^JW!du/m"><field name="index">101</field></shadow></value><next><block type="spritesetpos" id="c(S?u]%3R%y5|J)O7Y8i"><value name="sprite"><block type="variables_get" id="tKvEZrrg_7vCxAc7!];f"><field name="VAR" id="K$!4;+[/}go6(]WT4-dg">shop_door2</field></block></value><value name="x"><shadow type="positionPicker" id="A@s4V3MmGl)[T-kaN4D)"><field name="index">136</field></shadow></value><value name="y"><shadow type="positionPicker" id="Y8]z[(8!rCC4[5@*=l]|"><field name="index">105</field></shadow></value><next><block type="spritedestroy2" id="S=}xVX)=S.b@7X*k/0bZ"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="iQ`VO]k+[;ew5.mORFWt"><field name="VAR" id="_=xPBVPX3xl5xi^;#:NT">npc_shop</field></block></value><next><block type="spritedestroy2" id="$UAQ(`FvlgA+n{XmzKp-"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="rg+ECUA~|:3E83_,R~!H"><field name="VAR" id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</field></block></value><next><block type="spritedestroy2" id="vf/V^9t*O.!1s;9pIcW:"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="QkiccNum9Dsb1Q*.q){O"><field name="VAR" id="H^j)nqzSBp!gYMvYuy/2">inside_gim_door2</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="spritesoverlap" id="cUG_7VF{)NsSC[x@Y+d{" x="1632" y="1513"><value name="HANDLER_DRAG_PARAM_sprite"><block type="argument_reporter_custom" id="W_=Z.soLqb@;;%9go={7"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">sprite5</field></block></value><value name="kind"><shadow type="spritekind" id="VFo8$N^uh.#)X[i(z;?$"><field name="MEMBER">player</field></shadow></value><value name="HANDLER_DRAG_PARAM_otherSprite"><block type="argument_reporter_custom" id="R=v|S(*o^:z1P)INuR/w"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">otherSprite5</field></block></value><value name="otherKind"><shadow type="spritekind" id="t@[jaVdWw6GR+X?O_1.{"><field name="MEMBER">inside_gim_door</field></shadow></value><statement name="HANDLER"><block type="gamesetbackgroundimage" id="1_Ul;^cX0EH^9Y6fsEs5"><value name="img"><shadow type="background_image_picker" id="pq;cT:Ntq4)Hufr42=$b"><field name="img">assets.image`gim`</field><data>{"commentRefs":[],"fieldData":{"img":"myImages.image8"}}</data></shadow></value><next><block type="variables_set" id="HThv9o7y:q.)8~NbLt,Y"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field><value name="VALUE"><shadow type="math_number" id="QvZnv?Yje9$C_m@)]|0b"><field name="NUM">0</field></shadow><block type="spritescreate" id=")yPf*Hu~%85A*JYiN0u("><value name="img"><shadow type="screen_image_picker" id="yz,,vu*vgR}=_OJJeaXy"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . 3 . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="d@q)2=,@g{GI+g,}(n`f"><field name="MEMBER">outside_gim_door</field></shadow></value></block></value><next><block type="variables_set" id="B@r*]6e`+73M.(_M_l8X"><field name="VAR" id="N}Z0ie)pc+3g/(tD;ffG">enemigo</field><value name="VALUE"><shadow type="math_number" id="n-$2AckO90JQq3-wvepW"><field name="NUM">0</field></shadow><block type="spritescreate" id="gM[]*;w|YD_Bais8QjF?"><value name="img"><shadow type="screen_image_picker" id="j%en6,F{Pj$J((Gy|(9U"><field name="img">img`
......cc66......
.....c6576c.....
....c677576c....
....cc677666....
...cc6c6667cc...
..6c666777cc6c..
..c76666766776..
..c6777777776c..
..cc67777776cc..
.c67cc76676676c.
.c777666667777c.
.c6777777777766.
.cc7767776776666
c676cc6766666776
c777766666677776
cc7777777777776c
.c676777677767c.
..cc667666766c..
...ccc6c66ccc...
.....cccccc.....
.......ee.......
......eeee......
.....eeeeee.....
.......ee.......
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="6sc/6ljX?mnfBmQyce.;"><field name="MEMBER">enemy</field></shadow></value></block></value><next><block type="spritesetpos" id="t:|!JLine4[3FNKG5t/#"><value name="sprite"><block type="variables_get" id="gL,`eXauT)P7CO~G-rG}"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="x"><shadow type="positionPicker" id="[(WDl*gn1-=]g5,ChWN]"><field name="index">82</field></shadow></value><value name="y"><shadow type="positionPicker" id="~vuj,2A@$J=0+`]F,Wp="><field name="index">99</field></shadow></value><next><block type="spritesetpos" id="PaMkNOSLU,.aO(E+jykQ"><value name="sprite"><block type="variables_get" id=".jJ2~0V4E,w^D;Tu+G_0"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field></block></value><value name="x"><shadow type="positionPicker" id="#l6,/BINRGR1;;Glp.ut"><field name="index">81</field></shadow></value><value name="y"><shadow type="positionPicker" id=";5)syfY6h}PbfvS#*I;$"><field name="index">110</field></shadow></value><next><block type="spritesetpos" id="q-}xy{|R02[.VNU9!V%:"><value name="sprite"><block type="variables_get" id="KTm,T9l{G9_dFQrZo[^."><field name="VAR" id="N}Z0ie)pc+3g/(tD;ffG">enemigo</field></block></value><value name="x"><shadow type="positionPicker" id="`3L.%Y~2:WHU$e*{{78l"><field name="index">113</field></shadow></value><value name="y"><shadow type="positionPicker" id="X%N9IhHKjnL93|I=XFxN"><field name="index">60</field></shadow></value><next><block type="spritedestroy2" id="%){QHXZ0dVO^f%kajU_j"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="aJl(.J~5nnX@t+f9qfO="><field name="VAR" id="H^j)nqzSBp!gYMvYuy/2">inside_gim_door2</field></block></value><next><block type="spritedestroy2" id="dNR/4I2;@/Yftgyol:`b"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id=":zASZ`rJgN]7[tKL}=?N"><field name="VAR" id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="spritesoverlap" id="?5njKS3b3BDn$cfTZ6,Y" x="2448" y="1513"><value name="HANDLER_DRAG_PARAM_sprite"><block type="argument_reporter_custom" id="@kk=^k.oYF0{YOjY^dIY"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">sprite3</field></block></value><value name="kind"><shadow type="spritekind" id="5KdFp?2PL39kvkQh^MUu"><field name="MEMBER">player</field></shadow></value><value name="HANDLER_DRAG_PARAM_otherSprite"><block type="argument_reporter_custom" id="{_,fhiu)TQv[D{BRVcG]"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">otherSprite3</field></block></value><value name="otherKind"><shadow type="spritekind" id="OUh.V60r*._%^iUnzfwT"><field name="MEMBER">shop_door</field></shadow></value><statement name="HANDLER"><block type="gamesetbackgroundimage" id="c?R^0l+sNrf)lLDb6FPt"><value name="img"><shadow type="background_image_picker" id="dO86N`B35tP-iRJ!g[2S"><field name="img">assets.image`tienda`</field><data>{"commentRefs":[],"fieldData":{"img":"myImages.image6"}}</data></shadow></value><next><block type="variables_set" id="x,1E-rFg%sO4Giamu]+2"><field name="VAR" id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</field><value name="VALUE"><shadow type="math_number" id="t6UVs[g?[QWQu+u;G*xh"><field name="NUM">0</field></shadow><block type="spritescreate" id="O+^bOZ3L:dM]/mx}2x38"><value name="img"><shadow type="screen_image_picker" id="nWh,sO+rSKkZ?wbBjvNi"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="nl}9.sWPezfC}2K^6A*2"><field name="MEMBER">central_park_door</field></shadow></value></block></value><next><block type="variables_set" id="k,j?/I!5#zgq=0Dl6-0f"><field name="VAR" id="_=xPBVPX3xl5xi^;#:NT">npc_shop</field><value name="VALUE"><shadow type="math_number" id="1s?=Jg;naz$(ISX}=}HT"><field name="NUM">0</field></shadow><block type="spritescreate" id="X4EbL_/+%w$!v=VM?dnX"><value name="img"><shadow type="screen_image_picker" id="`d(|.XM@SllSIzL7[AyD"><field name="img">assets.image`door3`</field><data>{"commentRefs":[],"fieldData":{"img":"myImages.image11"}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="L$BKt=!Z4$kk,s+MwOkM"><field name="MEMBER">npc</field></shadow></value></block></value><next><block type="spritesetpos" id="#Mn)do`3Gk3_J0^pU9/F"><value name="sprite"><block type="variables_get" id="$%r;^c!#uo{$@2):G~LD"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="x"><shadow type="positionPicker" id="MhFnqU/)sB3U6IB*.X(j"><field name="index">106</field></shadow></value><value name="y"><shadow type="positionPicker" id="n}3xO+Czzh^nSoA^Q[`j"><field name="index">91</field></shadow></value><next><block type="spritesetpos" id="b3o^g%gkQ)lPvU(Lz+o/"><value name="sprite"><block type="variables_get" id="Zn)@a6znQUQu2t9;w0dE"><field name="VAR" id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</field></block></value><value name="x"><shadow type="positionPicker" id="yr6nFl::1s^V#3`=qG.?"><field name="index">106</field></shadow></value><value name="y"><shadow type="positionPicker" id="nrQ!R@N#YG!M+ryoT(bm"><field name="index">109</field></shadow></value><next><block type="spritesetpos" id="aRW;Y}_1OH[iFhlnc*,q"><value name="sprite"><block type="variables_get" id="d=P0}sFTthA;{DL;:PkI"><field name="VAR" id="_=xPBVPX3xl5xi^;#:NT">npc_shop</field></block></value><value name="x"><shadow type="positionPicker" id="54.DRAA1zsh)M$67F9E3"><field name="index">112</field></shadow></value><value name="y"><shadow type="positionPicker" id="V;nUxO0(48iP_nqL)9?n"><field name="index">37</field></shadow></value><next><block type="spritedestroy2" id="Zu^XTZTjiAAlQ=tv3}:A"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="JXlp)6Bu96n}ijVL695e"><field name="VAR" id="K$!4;+[/}go6(]WT4-dg">shop_door2</field></block></value><next><block type="spritedestroy2" id="}.d:8=Ww!k@/lJzEX-O%"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="D5d0Y$8-c`|;Rb-AC,=o"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="spritesoverlap" id="3Zw%gHo2?+B/hQZ}z~AB" x="3214" y="1513"><value name="HANDLER_DRAG_PARAM_sprite"><block type="argument_reporter_custom" id="5x9A(`5=e9p*-N]Uck35"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">sprite2</field></block></value><value name="kind"><shadow type="spritekind" id="my8;?_uRhK$f4?Snb($u"><field name="MEMBER">player</field></shadow></value><value name="HANDLER_DRAG_PARAM_otherSprite"><block type="argument_reporter_custom" id="Qe^]y?ac;~9.[Lk:%e`E"><mutation duplicateondrag="true" typename="Sprite"></mutation><field name="VALUE">otherSprite2</field></block></value><value name="otherKind"><shadow type="spritekind" id="pt}08=jgJsgeK~Qnn,A("><field name="MEMBER">outside_gim_door</field></shadow></value><statement name="HANDLER"><block type="gamesetbackgroundimage" id="kAQ_T1tNHHD8~yIrG-`3"><value name="img"><shadow type="background_image_picker" id="R,VAPYSo]ZI^TZpx[%XC"><field name="img">assets.image`gim_door`</field><data>{"commentRefs":[],"fieldData":{"img":"myImages.image9"}}</data></shadow></value><next><block type="variables_set" id="kr)I5^v*{PZ81[NPe,z;"><field name="VAR" id="H^j)nqzSBp!gYMvYuy/2">inside_gim_door2</field><value name="VALUE"><shadow type="math_number" id=",J1z/NReGj.,d?N1iX;0"><field name="NUM">0</field></shadow><block type="spritescreate" id="R7{puKz=hM8$e?g@Gsdm"><value name="img"><shadow type="screen_image_picker" id="ESF}A0b)9;wi6wucaV2|"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="Q-fd~*:0V48@ZI!+3SIo"><field name="MEMBER">inside_gim_door</field></shadow></value></block></value><next><block type="variables_set" id="G_~DKwTI;(w1YZ)=AGNe"><field name="VAR" id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</field><value name="VALUE"><shadow type="math_number" id="`x!Sbn1Vd)npoKVseT2$"><field name="NUM">0</field></shadow><block type="spritescreate" id="Uth[GRW1^TC{+FedudM,"><value name="img"><shadow type="screen_image_picker" id="Sr^sizITRUso?~C`P8G^"><field name="img">img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`</field><data>{"commentRefs":[],"fieldData":{"img":null}}</data></shadow></value><value name="kind"><shadow type="spritekind" id="H=KN~$Fwln7EJ?5^Il,7"><field name="MEMBER">central_park_door</field></shadow></value></block></value><next><block type="spritesetpos" id="4BgugQJ8BxZ{0TVIT%p@"><value name="sprite"><block type="variables_get" id="cLYrniaiLR1I23,2(it`"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="x"><shadow type="positionPicker" id="Su1v}_PMWVFi=w;ErZHi"><field name="index">129</field></shadow></value><value name="y"><shadow type="positionPicker" id="CJgya!N0D/L*?$2}6iP,"><field name="index">20</field></shadow></value><next><block type="spritesetpos" id="@^@8GySZgD$:iI3:_l`?"><value name="sprite"><block type="variables_get" id="sRWD42v1W*Sr2iGr=s0f"><field name="VAR" id="H^j)nqzSBp!gYMvYuy/2">inside_gim_door2</field></block></value><value name="x"><shadow type="positionPicker" id="_8HnbQDc^BiiNW;v`e_*"><field name="index">87</field></shadow></value><value name="y"><shadow type="positionPicker" id="Sl@cZRaeDmu`])P2zQmh"><field name="index">50</field></shadow></value><next><block type="spritesetpos" id="E*N{+{BWuGH2?Fci[2ks"><value name="sprite"><block type="variables_get" id="e`COib[|%U+U91C:1V^;"><field name="VAR" id="%QA6$D3[Y?C4R{k3:P4o">central_park_door2</field></block></value><value name="x"><shadow type="positionPicker" id="r4K161}*-u;Fn.$)%@cv"><field name="index">144</field></shadow></value><value name="y"><shadow type="positionPicker" id="e6bRwFkwsuE9?9wZNp-/"><field name="index">7</field></shadow></value><next><block type="spritedestroy2" id="J+|0gNhYyezzr^=B(xe:"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="ksHJEtc5D?h^38:{iY-1"><field name="VAR" id="K$!4;+[/}go6(]WT4-dg">shop_door2</field></block></value><next><block type="spritedestroy2" id="8+6X+7[QSC2^?f~4Y#nk"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="~9X6{vWR-UY[JK#v6Crj"><field name="VAR" id="EgjM14I?,1(stN~FXAP(">outside_gim_door2</field></block></value><next><block type="spritedestroy2" id="7yj7^5ngus2J)T?1@|[Y"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="0" _input_init="true"></mutation><field name="effect">effects.spray</field><value name="sprite"><block type="variables_get" id="(+H@N*t~=mo~VAfVGR2I"><field name="VAR" id="N}Z0ie)pc+3g/(tD;ffG">enemigo</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="+c$eP`UDjYBrbQpNsYs1" x="4039" y="1513"><mutation name="abrir_menu" functionid=",{3k=b4,88Me^4Zf`+W^"></mutation><field name="function_name">abrir_menu</field><comment pinned="false" h="80" w="160">---
=======================================================
III. FUNCIONES DE MENÚ/TRUEQUE
=======================================================</comment><statement name="STACK"><block type="controls_if" id="]^]=:7hA::;etr@b3:1/"><value name="IF0"><shadow type="logic_boolean" id="LR1%lJ^y1Lv5tc#72Cny"><field name="BOOL">TRUE</field></shadow><block type="logic_negate" id="WRC*K@32(Z:I[tMK%aiZ"><value name="BOOL"><shadow type="logic_boolean" id=")kDknyg8^HkpS2qx2pJ6"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="o#n5a0w$.%@8n[_al@)5"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field></block></value></block></value><statement name="DO0"><block type="variables_set" id=")^1q9{SY!)m.^qY-gdkG"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field><value name="VALUE"><shadow type="math_number" id="w94a0!GW1-EHXQ)J28K_"><field name="NUM">0</field></shadow><block type="logic_boolean" id="56%yjHQP}J,tj8T@ba)3"><field name="BOOL">TRUE</field></block></value><next><block type="variables_set" id="t/C0CgT-`Bc(][Q2$ql3"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field><value name="VALUE"><shadow type="math_number" id="i]SU3BHfYsR)HZT90F1n"><field name="NUM">0</field></shadow></value><next><block type="game_control_sprite" id="#i2?==ax`:F_z%yM5bL9"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="2" _input_init="true"></mutation><value name="sprite"><block type="variables_get" id="e:#*C.Nd/SROvx(CFW%f"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="vx"><shadow type="spriteSpeedPicker" id="Z.)D4@2)G]~*xL=T=Byw"><field name="speed">0</field></shadow></value><value name="vy"><shadow type="spriteSpeedPicker" id="n@m#^Mo=J9]0::3F|{kK"><field name="speed">0</field></shadow></value><next><block type="game_show_long_text" id="(dHN}gE9Wg9n^#r.oaGy"><field name="layout">DialogLayout.Bottom</field><comment pinned="false" h="80" w="160">Detenemos al personaje</comment><value name="str"><shadow type="text" id="pe6kZnAVny`X{.r)V$`A"><field name="TEXT"></field></shadow><block type="typescript_expression" id="=_Pn!HT_AOsVnbj!n,WA"><field name="EXPRESSION">`
                Intercambio: \{nombres_visibles[indice]\}
                Usa Arriba/Abajo para navegar. A para comprar.
                `</field></block></value></block></next></block></next></block></next></block></statement></block></statement></block><block type="function_definition" id="HPmHb|Yj53[mbQiW55nD" x="20" y="2132"><mutation name="cerrar_menu" functionid="JF2l7=SQvmJkAMK9M_xE"></mutation><field name="function_name">cerrar_menu</field><statement name="STACK"><block type="controls_if" id="8DOjRyjNocWGrupz6p{~"><value name="IF0"><shadow type="logic_boolean" id="-2jB;853L9zj#{vIri=%"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="=GP*1J,v2N^n#A-oAC4Z"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field></block></value><statement name="DO0"><block type="variables_set" id="|i36x2$gb9@rLjQ}ewt9"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field><value name="VALUE"><shadow type="math_number" id="~aLqWpaw5fV3s(cVa]ZA"><field name="NUM">0</field></shadow><block type="logic_boolean" id="S#U~p`E%@IJDP6D.R~x)"><field name="BOOL">FALSE</field></block></value><next><block type="game_control_sprite" id="kR?+)su!z;@KtV`M-/k`"><mutation xmlns="http://www.w3.org/1999/xhtml" _expanded="2" _input_init="true"></mutation><comment pinned="false" h="80" w="160">Revertimos el control de movimiento</comment><value name="sprite"><block type="variables_get" id="R9}WF7XGKLMvn4#Uo3rV"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="vx"><shadow type="spriteSpeedPicker" id="-#i~Xr49RuaMeR.yE;c3"><field name="speed">100</field></shadow></value><value name="vy"><shadow type="spriteSpeedPicker" id="Leg@Es%tCNgJzlC(2L3l"><field name="speed">100</field></shadow></value><next><block type="game_show_long_text" id="]#LPNOlPZp|9IK[l[=4I"><field name="layout">DialogLayout.Bottom</field><value name="str"><shadow type="text" id="Cqd!%Kj=mBqsV{lb6)|R"><field name="TEXT">Menú de intercambio cerrado.</field></shadow></value></block></next></block></next></block></statement><next><block type="controls_if" id="Fp.ZOy@(.NgLmi1kqGed"><comment pinned="false" h="80" w="160">Aseguramos que el botón A vuelva a la normalidad si el cierre viene por Trueque</comment><value name="IF0"><shadow type="logic_boolean" id="DxxSU:wlvyl88-:3}L_o"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="+,q^fRjCQ/5I]$`!vqek"><field name="OP">AND</field><value name="A"><shadow type="logic_boolean" id="nU0D]?til)Q^|U]iU;tG"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="WnsmgNqX)ztRMg7=QWFK"><field name="VAR" id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</field></block></value><value name="B"><shadow type="logic_boolean" id="~8cJFb?39f(|~h$)07t/"><field name="BOOL">TRUE</field></shadow><block type="logic_negate" id="E]LV|2`6^[kuz8U!*e*M"><value name="BOOL"><shadow type="logic_boolean" id="|3p1c|,:K]C;]vn]yp|u"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="xO;,]Brsd?/#Y~Zd@B^q"><field name="VAR" id=".6ZlkT6e-^8frma:7%|I">esta_en_npc</field></block></value></block></value></block></value><statement name="DO0"><block type="typescript_statement" id="ekHv=s~#y(I@#l;USbq["><mutation xmlns="http://www.w3.org/1999/xhtml" line0="controller.A.onEvent(ControllerButtonEvent.Pressed, on_a_normal_action)" numlines="1"></mutation><next><block type="variables_set" id="P4su^{XkY.cq6.Fq3)j$"><field name="VAR" id="u{((Zb|P|t9i|.EH1_^q">manejador_A_activo</field><value name="VALUE"><shadow type="math_number" id="Op0cyE,p)e]9W{.d7:}M"><field name="NUM">0</field></shadow><block type="logic_boolean" id="~ulXirN(iohVMnS5Uny5"><field name="BOOL">FALSE</field></block></value></block></next></block></statement></block></next></block></statement></block><block type="function_definition" id="llqK7bYm)aEXI/F=XO^8" x="725" y="2134"><mutation name="on_a_normal_action" functionid="4dD/T?3]e}_1F20/yWgp"></mutation><field name="function_name">on_a_normal_action</field><comment pinned="false" h="80" w="160">---
=======================================================
IV. MANEJO DE ENTRADAS/CONTROLADOR
=======================================================
Función del botón A cuando NO está en modo NPC/Menú (Acción normal: Ataque)</comment><statement name="STACK"><block type="controls_if" id="Wj{0v(N5wx_$Y6ds7Ehy"><mutation else="1"></mutation><value name="IF0"><shadow type="logic_boolean" id="]vN}#@nl8jkfz)wYnH|j"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="g1-fmAzur@^Nn#b(Yj_$"><field name="VAR" id="LZ`f3S}xU]oO]u%Nd_7#">estado_menu</field></block></value><statement name="DO0"><block type="function_call" id="E[SJcXIS|3/q]58v*6rt"><mutation name="procesar_trueque" functionid="Fa+|w?VuxcZ5S|ru](0J"></mutation><comment pinned="false" h="80" w="160">Si el menú está abierto (debería ser imposible si A no está reasignado, pero como seguro)</comment></block></statement><statement name="ELSE"><block type="run_image_animation" id="nK28P9pisIoBZU-G+ifM"><comment pinned="false" h="80" w="160">Acción normal (Ataque/Golpe)</comment><value name="sprite"><block type="variables_get" id="QE|-G?4z8s=Y7+O,_vbK"><field name="VAR" id="NV9z+Oh6*.9b5B.+uX;4">villager</field></block></value><value name="frames"><shadow type="animation_editor" id="2Y+5{P#|%=1?!96h|W}$"><field name="frames">assets.animation`myAnim3`</field><data>{"commentRefs":[],"fieldData":{"frames":"myAnimations.anim5"}}</data></shadow></value><value name="frameInterval"><shadow type="timePicker" id="O-WCtO8cf#sB*I4LhYe7"><field name="ms">200</field></shadow></value><value name="loop"><shadow type="toggleOnOff" id="H8+n#Sp2qJ3RgU_uJ*?}"><field name="on">false</field></shadow></value><next><block type="controls_if" id="~BxV4nV1H%s)PyA[!lxG"><value name="IF0"><shadow type="logic_boolean" id="7(?KjMSfzNAo.J+|c=Fk"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="-)c-eC%#Wom7DY,@ony-"><field name="VAR" id="HsyTT}HCj^M3Q!3z(zy~">proximidad</field></block></value><statement name="DO0"><block type="variables_change" id="#F8+]kE8.X/P-ysHcl@A"><field name="VAR" id="xipzET^NR{T;IT|Ki[wF">hit</field><value name="VALUE"><shadow type="math_number" id="yUq[=[imaPkeV;C#Eh1["><field name="NUM">1</field></shadow></value></block></statement></block></next></block></statement></block></statement></block><block type="function_definition" id="x#wk.I9Iy($.cT;hS;w5" x="1108" y="2132"><mutation name="procesar_trueque" functionid="Fa+|w?VuxcZ5S|ru](0J"></mutation><field name="function_name">procesar_trueque</field><comment pinned="false" h="80" w="160">=======================================================
III. FUNCIONES DE MENÚ/TRUEQUE (CORREGIDO)
=======================================================</comment><statement name="STACK"><block type="variables_set" id="Km^aLy^tR:ct.?fKenSb"><field name="VAR" id="(!,hX%3g(2N,=?rnX.SX">nombre_articulo</field><value name="VALUE"><shadow type="math_number" id="r+O(O%VKAp,Xb]1FZsoM"><field name="NUM">0</field></shadow><block type="lists_index_get" id="nbHL[w8O2[wXmUf~(=o1"><value name="LIST"><block type="variables_get" id="PeLjsi17He?0%=t;=$F8"><field name="VAR" id="ba_J7m(,?6IX:,]_k:8z">nombres_visibles</field></block></value><value name="INDEX"><shadow type="math_number" id="U8DXZqCy)ToVtI;OvA:2"><field name="NUM">0</field></shadow><block type="variables_get" id="pnbJ5UVC9F0QVt7L`3Wk"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field></block></value></block></value><next><block type="variables_set" id="gY:UdQ_fg?w^(tvAIM*1"><field name="VAR" id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</field><comment pinned="false" h="80" w="160">SOLUCIÓN DEFINITIVA: Solo cortamos la cadena y aceptamos el posible espacio final.
El operador 'in' es flexible y funcionará.</comment><value name="VALUE"><shadow type="math_number" id="tc%i~ZTwhP[[at1Y`Oc-"><field name="NUM">0</field></shadow><block type="lists_index_get" id="@U4H}:72J{GbElGS8$VF"><value name="LIST"><block type="string_split" id="#Y]xu.I2A)y_OEsp2Cjq"><value name="this"><shadow type="text" id=";v6J~vnGt^/A=EHERe_O"><field name="TEXT"></field></shadow><block type="variables_get" id="u*=*_F6^{@dB5f0R+Z|O"><field name="VAR" id="(!,hX%3g(2N,=?rnX.SX">nombre_articulo</field></block></value><value name="separator"><shadow type="text" id="%6@YRs$y$(:r4KyvZ?ed"><field name="TEXT">(</field></shadow></value></block></value><value name="INDEX"><shadow type="math_number" id="^6!r(?0Q@8~Fdu0VQ/e9"><field name="NUM">0</field></shadow></value></block></value><next><block type="variables_set" id="gm`AO.y(1w^4.s8-Yn(h"><field name="VAR" id="r4|7GbebQV21}V*+D`vq">precio_leña</field><value name="VALUE"><shadow type="math_number" id="7FXn:jj%iK7z-Ewi0Gb!"><field name="NUM">0</field></shadow><block type="lists_index_get" id="iT)M#D0U2.TpU6(Wp2iK"><value name="LIST"><block type="variables_get" id="JA(deD,1yAvT`[k]8hS["><field name="VAR" id="0sL=HgQ|3!(yL_h9F_%0">precios</field></block></value><value name="INDEX"><shadow type="math_number" id="!2UJ*vUgsfXX5DlnS8+)"><field name="NUM">0</field></shadow><block type="variables_get" id="}wRCE%cmro[diM*Gv[2U"><field name="VAR" id="-A(,}hw]S0-zH^U-P!h;">indice</field></block></value></block></value><next><block type="controls_if" id="wQijMI04t};LJd-ysa-g"><mutation else="1"></mutation><value name="IF0"><shadow type="logic_boolean" id="D;)iU,Q/yxT;Y4CCm%A#"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="zaf38mr)tSF+_-+Nhi=`"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id="5}h;,VRy]x6sL-CMdhuL"><field name="NUM">0</field></shadow><block type="hudScore" id="O*kU}K[glo5+dI4@:.A6"></block></value><value name="B"><shadow type="math_number" id="4FS#(`X9i}cV;FsG6C#:"><field name="NUM">0</field></shadow><block type="variables_get" id=",^.F{5-rT.`}MUx%G$G)"><field name="VAR" id="r4|7GbebQV21}V*+D`vq">precio_leña</field></block></value></block></value><statement name="DO0"><block type="hudChangeScoreBy" id="^1t0X-zz])S]tQ7XL%I1"><value name="value"><block type="math_arithmetic" id="AS]Dn1h#+Xo*JTvoGQ3u"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="!XeXbZ#3V#L@#G_w*2H#"><field name="NUM">-1</field></shadow></value><value name="B"><shadow type="math_number" id="/Hzjc5HD%c-9*TFYfh-O"><field name="NUM">0</field></shadow><block type="variables_get" id="=N#T8?,%vlE8Lv{akiL%"><field name="VAR" id="r4|7GbebQV21}V*+D`vq">precio_leña</field></block></value></block></value><next><block type="controls_if" id="FW+l*R1GCUV/C?bCXKi2"><mutation elseif="4"></mutation><comment pinned="false" h="80" w="160">Lógica de Inventario: El operador 'in' manejará el espacio final ("Gallina" in "Gallina ")</comment><value name="IF0"><shadow type="logic_boolean" id="`)?2t(f9Cy/;=0roN145"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="J]2;ThTHSGE)p?T)DC2x"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id="QUA=`%Q:]+`a$Q@R;%6+"><field name="NUM">0</field></shadow><block type="string_indexof" id=".l/T%ZSe:]tq7WW,ETbC"><value name="this"><shadow type="text" id="NUW`DP6QBv2zO.:td;P~"><field name="TEXT"></field></shadow><block type="variables_get" id="j]9|W!f0JpeI:C%xLJe4"><field name="VAR" id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</field></block></value><value name="searchValue"><shadow type="text" id="{02(Wt-9KbqiKalej*?N"><field name="TEXT">Gallina</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="Z=~Tcw].G^]@rIz.dX,o"><field name="NUM">0</field></shadow></value></block></value><statement name="DO0"><block type="variables_change" id="e[|@Qw{=:NZ]LI=!2UCi"><field name="VAR" id="ZRczQc(Jao*v7DE!j(HN">gallinas</field><value name="VALUE"><shadow type="math_number" id="XJ+`en`=/L%[AM1p4^$!"><field name="NUM">1</field></shadow></value></block></statement><value name="IF1"><shadow type="logic_boolean" id=".|GUgJgDO=6M8x]OO.Z4"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="B6CDHD?~)4C[1ZzDD=!_"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id="Q;A#x!$}{Y/6:I*HxeKK"><field name="NUM">0</field></shadow><block type="string_indexof" id="QUg=zq?rx6FQ8}^!=n(g"><value name="this"><shadow type="text" id="wIcD+041oI6/@FC00Uei"><field name="TEXT"></field></shadow><block type="variables_get" id="}p$/K^j@J2U+^(;ZVESn"><field name="VAR" id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</field></block></value><value name="searchValue"><shadow type="text" id="r[CT7~q2V?t15)~L#qZ6"><field name="TEXT">Patata</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="nTIAzRsV$_K!C[ZWtA(D"><field name="NUM">0</field></shadow></value></block></value><statement name="DO1"><block type="variables_change" id="{fbno)sre*dFS/%+w`(F"><field name="VAR" id="6[ft;.+Mp/a)dl2v%2[}">patatas_kg</field><value name="VALUE"><shadow type="math_number" id="v=p@N:$[iVt{gDaVDm@Y"><field name="NUM">1.5</field></shadow></value></block></statement><value name="IF2"><shadow type="logic_boolean" id="~}T1^zYMXN.x)!UHULjI"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="Pqi8A2yV#[s+HF_#Sja`"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id="E!A)`aXzz)w$UlEElz-]"><field name="NUM">0</field></shadow><block type="string_indexof" id="aOAtc4sP]!fY~|ja:j:n"><value name="this"><shadow type="text" id="7uH^4GU)6AT~}w3799j%"><field name="TEXT"></field></shadow><block type="variables_get" id="9b:!~~J~b,`wBbPxeHpB"><field name="VAR" id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</field></block></value><value name="searchValue"><shadow type="text" id="9W!y`3L5yJ]wQbYU[oWz"><field name="TEXT">Cabra</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="C5o3sz@]@`(^64f8[uv-"><field name="NUM">0</field></shadow></value></block></value><statement name="DO2"><block type="variables_change" id="L:b?rHj{.MW|[B:cR)XQ"><field name="VAR" id="}ge6-sZ(a:`:D5AdpeB;">cabras</field><value name="VALUE"><shadow type="math_number" id="tT|3A9yyR)^0%Cy,ZZSq"><field name="NUM">1</field></shadow></value></block></statement><value name="IF3"><shadow type="logic_boolean" id="#.,p{_C0bgj^hO(~}~5B"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="Ocz6hI2Q(8n1;rS967{#"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id="jE0oB9h8VKj6NLf./w;N"><field name="NUM">0</field></shadow><block type="string_indexof" id="x4KA|/9rytDuNVLq]u~{"><value name="this"><shadow type="text" id="T4[Cm1p(o5=`{9hK-)K!"><field name="TEXT"></field></shadow><block type="variables_get" id=",)4~w+),MJ8EWk.:AYME"><field name="VAR" id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</field></block></value><value name="searchValue"><shadow type="text" id="Q/,=U?*M|2!n6I7Mf?4j"><field name="TEXT">Huevos</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="c_yOPBvc{dCR:7vUEuY="><field name="NUM">0</field></shadow></value></block></value><statement name="DO3"><block type="variables_change" id="AqFWuO.WVPL=v~}+e;[E"><field name="VAR" id="NgpZq8kEndnk^@mB4.o}">huevos</field><value name="VALUE"><shadow type="math_number" id="*5c/]nCFW569c(X`@;nw"><field name="NUM">12</field></shadow></value></block></statement><value name="IF4"><shadow type="logic_boolean" id=",**aP;)iMcDi%7C-xAZ-"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="k2kaWnW[oYUy)[LazeK3"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id=",)u|)k/8d7[~xM}-B~cz"><field name="NUM">0</field></shadow><block type="string_indexof" id="79Ea5|!y|xp-6L:8X1C%"><value name="this"><shadow type="text" id="P$]gO:1wGj5%)6)d/WY9"><field name="TEXT"></field></shadow><block type="variables_get" id="[KFUK=DiR:SNoC7YYLfi"><field name="VAR" id="W7]n)+:6/{o0[Oz@+%TL">nombre_sin_coste</field></block></value><value name="searchValue"><shadow type="text" id="KA9w~E-V*@GHe`qelZ6-"><field name="TEXT">Caballo</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="#s=/=,5].rrdp4A/%nBr"><field name="NUM">0</field></shadow></value></block></value><statement name="DO4"><block type="variables_change" id="nv9:{H;vCS[%4sx9zkMM"><field name="VAR" id="D?G`r8:r#2_ptXBkR^t1">caballos</field><value name="VALUE"><shadow type="math_number" id="vqIR@T1s2h%W?`2mEq^:"><field name="NUM">1</field></shadow></value></block></statement><next><block type="game_show_long_text" id="5!tb0ZU%y=-9HEPb8}e}"><field name="layout">DialogLayout.Bottom</field><value name="str"><shadow type="text" id="J(%){s|J)j#`u.R6z,Gf"><field name="TEXT">¡Trueque realizado! Tienes un(a) {nombre_sin_coste}. Leña restante: {info.score()} kg.</field></shadow></value><next><block type="function_call" id="?zu|^?z*#`)vle0vm64*"><mutation name="cerrar_menu" functionid="JF2l7=SQvmJkAMK9M_xE"></mutation></block></next></block></next></block></next></block></statement><statement name="ELSE"><block type="game_show_long_text" id=":h.9g3{8XhR@qyP4Y]/s"><field name="layout">DialogLayout.Bottom</field><value name="str"><shadow type="text" id="21Yy];osoquG[IjH7,bo"><field name="TEXT">¡Necesitas {precio_leña} kg de leña! Solo tienes {info.score()} kg.</field></shadow></value><next><block type="game_show_long_text" id="O?q9`VxjMuVZ1FJ;9,Q$"><field name="layout">DialogLayout.Bottom</field><value name="str"><shadow type="text" id="2Vow8Hm!v-(;_,IWmALx"><field name="TEXT">Intercambio: {nombres_visibles[indice]}</field></shadow></value></block></next></block></statement></block></next></block></next></block></next></block></statement></block></xml>